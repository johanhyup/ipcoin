(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[27708],{342707:(e,t,i)=>{"use strict";i.d(t,{formatStudyError:()=>s,triesTranslateError:()=>r});var n=i(444372);function r(e){return o.get(e)||e}function s(e){return e.format({boldHighlightStart:"<b>",boldHighlightEnd:"</b>"})}const o=new Map([["You cannot see this pivot timeframe on this resolution",n.t(null,void 0,i(525059))],["The data vendor doesn't provide volume data for this symbol.",n.t(null,void 0,i(81657))],['Histogram is too large, please increase "Row Size" input.',n.t(null,void 0,i(872819))],["Histogram is too large, please reduce 'Row Size' input.",n.t(null,void 0,i(566751))],['Histogram is too large, please increase "Ticks Per Row" input.',n.t(null,void 0,i(594966))],["This script is invite-only. To request access, please contact its author.",n.t(null,void 0,i(276989))],["Volume Profile indicator available only on our upgraded plans.",n.t(null,void 0,i(139903))],["VOLUME_BIST_MIXED",n.t(null,void 0,i(469156))],["Runtime error",n.t(null,void 0,i(660630))],["Access error",n.t(null,void 0,i(377401))],["User-defined error",n.t(null,void 0,i(708580))],["Compilation error",n.t(null,void 0,i(212086))]])},370407:(e,t,i)=>{"use strict";i.d(t,{TranslatedString:()=>n});class n{constructor(e,t){this._originalText=e,this._translatedText=t}originalText(){return this._originalText}translatedText(){return this._translatedText}format(e){const t={},i={};for(const r of Object.keys(e)){const s=e[r];s instanceof n?(t[r]=s.originalText(),i[r]=s.translatedText()):(t[r]=s.toString(),i[r]=s.toString())}const r=this._originalText.format(t),s=this._translatedText.format(i);return new n(r,s)}}},306060:(e,t,i)=>{"use strict";i.d(t,{Version:()=>r});var n=i(650151);class r{constructor(e,t){this._major=e,this._minor=t}major(){return this._major}minor(){return this._minor}isZero(){return 0===this._major&&0===this._minor}toString(){return this._major+"."+this._minor}compareTo(e){return this._major<e._major?-1:this._major>e._major?1:this._minor<e._minor?-1:this._minor>e._minor?1:0}isLess(e){return this.compareTo(e)<0}isLessOrEqual(e){return this.compareTo(e)<=0}isEqual(e){return 0===this.compareTo(e)}isGreater(e){return this.compareTo(e)>0}isGreaterOrEqual(e){return this.compareTo(e)>=0}static parse(e){if(e instanceof r)return new r(e.major(),e.minor());if("number"==typeof e)return(0,n.assert)(Math.floor(e)===e,"Version should not be a float number"),new r(e,0);if("string"==typeof e){const t=e.split(".");if(1===t.length){const i=parseInt(t[0],10);return(0,n.assert)(!isNaN(i),"Bad version string: "+e),new r(i,0)}if(2===t.length){const i=parseInt(t[0],10);(0,n.assert)(!isNaN(i),"Bad version string: "+e);const s=parseInt(t[1],10);return(0,n.assert)(!isNaN(s),"Bad version string: "+e),new r(i,s)}throw new Error("Bad version string (one dot expected): "+e)}throw new Error("Bad version: "+e)}}r.ZERO=new r(0,0)},566238:(e,t,i)=>{"use strict";i.d(t,{WatchedObject:()=>o});var n=i(375397),r=i(124829);function s(e,t){return(0,r.deepEquals)(e,t)[0]}
class o extends n.WatchedValue{constructor(e,t=s){super(e),this._comparator=t}setValue(e,t){(t||!1===this._comparator(this.value(),e))&&super.setValue(e,t)}}},259336:(e,t,i)=>{"use strict";i.d(t,{PaneInvalidationMask:()=>r});var n=i(219849);class r{constructor(e=n.defaultInvalidationLevel){this._paneInvalidationLevel=n.defaultInvalidationLevel,this._leftPriceScalesInvalidationMap=new Map,this._rightPriceScalesInvalidationMap=new Map,this._legendWidgetInvalidated=!1,this._invalidationLevel=e}fullInvalidation(){return this._invalidationLevel}invalidateAll(e){this._invalidationLevel=Math.max(this._invalidationLevel,e)}invalidatePane(e){this._paneInvalidationLevel=Math.max(this._invalidationLevel,e)}invalidateLegendWidgetLayout(){this._legendWidgetInvalidated=!0}invalidatePriceScale(e,t,i){const r="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap,s=r.get(t)||n.defaultInvalidationLevel;r.set(t,Math.max(s,i))}invalidationLevelForPane(){return Math.max(this._paneInvalidationLevel,this._invalidationLevel)}legendWidgetLayoutInvalidated(){return this._legendWidgetInvalidated||this._invalidationLevel===n.InvalidationLevel.Full}getterForPriceScaleInvalidationLevelBySide(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;return e=>Math.max(t.get(e)||n.defaultInvalidationLevel,this._invalidationLevel)}priceScaleSideMaxLevel(e){const t="left"===e?this._leftPriceScalesInvalidationMap:this._rightPriceScalesInvalidationMap;let i=this._invalidationLevel;return t.size>0&&t.forEach((e=>{e>i&&(i=e)})),i}merge(e){this._invalidationLevel=Math.max(this._invalidationLevel,e._invalidationLevel),this._paneInvalidationLevel=Math.max(this._paneInvalidationLevel,e._paneInvalidationLevel),e._leftPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._leftPriceScalesInvalidationMap.get(t)||n.defaultInvalidationLevel;this._leftPriceScalesInvalidationMap.set(t,Math.max(i,e))})),e._rightPriceScalesInvalidationMap.forEach(((e,t)=>{const i=this._rightPriceScalesInvalidationMap.get(t)||n.defaultInvalidationLevel;this._rightPriceScalesInvalidationMap.set(t,Math.max(i,e))})),this._legendWidgetInvalidated=this._legendWidgetInvalidated||e._legendWidgetInvalidated}}},354957:(e,t,i)=>{"use strict";i.d(t,{alertsAvailable:()=>n});const n=i(764829).enabled("alerts")},198930:(e,t,i)=>{"use strict";i.d(t,{isLineToolState:()=>o,isMainSeriesState:()=>r,isStudyLineToolState:()=>a,isStudyState:()=>s});var n=i(627620);function r(e){return"MainSeries"===e.type}function s(e){return Boolean(e.type)&&e.type.toLowerCase().startsWith("study")}function o(e){return Boolean(e.type)&&(0,n.isLineToolName)(e.type)}function a(e){return Boolean(e.type)&&(0,n.isStudyLineToolName)(e.type)}},903424:(e,t,i)=>{"use strict";i.d(t,{DataSource:()=>p,getTranslatedStringForSource:()=>d,toInputDisplayFlags:()=>c});var n=i(370407),r=i(287741),s=i(79342),o=i(942634),a=i(354957),l=i(375397),u=i(218049);function d(e,t){return new n.TranslatedString(t.name(),t.title(e))}function c(e){switch(e){
case r.TitleDisplayTarget.DataWindow:return u.InputDisplayFlags.DataWindow;case r.TitleDisplayTarget.StatusLine:case r.TitleDisplayTarget.Alerts:return u.InputDisplayFlags.StatusLine}}class p{constructor(e){this.isSeries=!1,this._isDestroyed=!1,this._hasAlert=new l.WatchedValue(!1),this._alertStatus=new l.WatchedValue(0),this._alertCreationAvailable=new l.WatchedValue(a.alertsAvailable),this._zorder=0,this._priceScale=null,this._ownerSource=null,this._userEditEnabled=!0,this._priceScaleChanged=new o.Delegate,this._isSelectionEnabled=!0,this._instanceId=(0,s.randomHashN)(6),this._ownerSourceChanged=new o.Delegate,this._zOrderChanged=new o.Delegate,this._id=new l.WatchedValue(e??(0,s.randomHashN)(6)),a.alertsAvailable&&Promise.resolve().then((()=>{this._isDestroyed||this._hasAlert.subscribe(this._updateAlertCreationAvailable.bind(this),{callWithLast:!0})}))}destroy(){this._isDestroyed=!0}id(){return this._id.value()}idWV(){return this._id.readonly()}instanceId(){return this._instanceId}preferNoScale(){return!1}setId(e){this._id.setValue(e)}zorder(){return this._zorder}setZorder(e){"number"==typeof e&&this._zorder!==e&&(this._zorder=e,this._zOrderChanged.fire(e))}preferredZOrder(){return null}isSpeciallyZOrderedSource(){return!1}title(e){return this.name()}priceScale(){return this._priceScale}setPriceScale(e){this._priceScale=e,this._priceScaleChanged.fire(e)}priceScaleChanged(){return this._priceScaleChanged}ownerSource(){return this._ownerSource}setOwnerSource(e){const t=this._ownerSource;this._ownerSource=e,this._ownerSourceChanged.fire(t,e)}ownerSourceChanged(){return this._ownerSourceChanged}zOrderChanged(){return this._zOrderChanged}isSavedInChart(e){return!0}isSavedInStudyTemplates(){return!0}isRemovedByStudyTemplates(){return!0}hasContextMenu(){return!0}showInObjectTree(){return!0}setUserEditEnabled(e){this._userEditEnabled=e}userEditEnabled(){return this._userEditEnabled}canBeHidden(){return this.userEditEnabled()}isUserDeletable(){return this.userEditEnabled()}properties(){return null}propertyByPath(e){const t=e.split(".");if(t.length<1)throw new Error("Invalid path");const i=t[0];if("properties"===i){const e=this.properties();return 1===t.length?e:e.childByPath(t.slice(1).join("."))}throw new Error(`Unknown property root: ${i}`)}isVisible(){return this.properties().visible.value()}dataWindowView(){return null}priceAxisViews(e,t){return null}timeAxisViews(){return null}updateAllViews(e){}paneViews(e){return null}labelPaneViews(e){return null}isFailed(){return!1}isLoading(){return!1}isPhantom(){return!1}isChildStudy(){return!1}hasChildren(){return!1}canHaveChildren(){return!1}onClickOutside(e,t){}getSourceIcon(){return null}state(e){return null}doesMovingAffectsUndo(){return!0}isMultiPaneAvailable(){return!1}isMultiPaneEnabled(){return!1}copiable(){return!1}cloneable(){return!1}movable(){return!1}isIncludedInAutoScale(){return!1}isHoveredEnabled(){return this.isSelectionEnabled()}showOnTopOnHovering(){return!0}isSelectionEnabled(){return this._isSelectionEnabled}setSelectionEnabled(e){this._isSelectionEnabled=e
}firstValue(){return null}priceRange(e,t,i){return null}autoScaleInfo(e,t,i){return{range:this.priceRange(e,t,i)}}stateForAlert(){return null}canHasAlert(){return!1}canHasAlertOnLineTools(){return!1}hasAlert(){return this._hasAlert.readonly()}alertCreationAvailable(){return this._alertCreationAvailable.readonly()}hasStateForAlert(){return a.alertsAvailable}idForAlert(){return this._id.value()}alertStatus(){return this._alertStatus.readonly()}_getAlertCreationAvailable(){return a.alertsAvailable&&this.hasStateForAlert()}_updateAlertCreationAvailable(){a.alertsAvailable&&this._alertCreationAvailable.setValue(this._getAlertCreationAvailable())}}},287741:(e,t,i)=>{"use strict";var n;i.d(t,{TitleDisplayTarget:()=>n}),function(e){e[e.DataWindow=1]="DataWindow",e[e.StatusLine=2]="StatusLine",e[e.Alerts=3]="Alerts"}(n||(n={}))},487945:(e,t,i)=>{"use strict";function n(e){return e?.symbolSource&&e.symbolSource()===e||void 0!==e?.isActingAsSymbolSource}function r(e){return n(e)&&"quotesProvider"in e}function s(e){return n(e)&&e.isActingAsSymbolSource().value()}i.d(t,{isActingAsSymbolSource:()=>s,isSymbolSource:()=>n,isSymbolSourceWithQuotesProvider:()=>r})},627620:(e,t,i)=>{"use strict";i.d(t,{isImageToolName:()=>c,isLineDrawnWithPressedButton:()=>l,isLineToolDrawWithoutPoints:()=>d,isLineToolFinishRequiredWhenCreatedByApi:()=>u,isLineToolName:()=>a,isMtpPredictorToolName:()=>s,isStudyLineToolName:()=>o,isTextToolName:()=>p})
;const n=new Set(["LineStudyMtpAnalysis","LineStudyMtpDecisionPoint","LineStudyMtpRiskReward","LineStudyMtpElliotWaveMain","LineStudyMtpElliotWaveMajor","LineStudyMtpElliotWaveMinor","LineStudyMtpDownWave1OrA","LineStudyMtpDownWave2OrB","LineStudyMtpDownWave3","LineStudyMtpDownWave4","LineStudyMtpDownWave5","LineStudyMtpDownWaveC","LineStudyMtpUpWave1OrA","LineStudyMtpUpWave2OrB","LineStudyMtpUpWave3","LineStudyMtpUpWave4","LineStudyMtpUpWave5","LineStudyMtpUpWaveC"]),r=new Set(["LineToolFibRetracement","LineToolFibChannel","LineToolFibSpeedResistanceArcs","LineToolProjection","LineToolTrendBasedFibExtension","LineToolElliott","LineToolFibCircles","LineToolVertLine","LineToolCrossLine","LineToolBarsPattern","LineToolTrendBasedFibTime","LineToolFibTimeZone","LineToolCircleLines","LineToolDateRange","LineToolPriceRange","LineToolDateAndPriceRange","LineToolParallelChannel","LineToolTrendAngle","LineToolTrendLine","LineToolInfoLine","LineToolArrowMark","LineToolPitchfan","LineToolGannSquare","LineToolFibSpeedResistanceFan","LineToolGannComplex","LineToolGannFixed","LineToolGannFan","LineToolFibWedge","LineToolPitchfork","LineToolDisjointAngle","LineToolFlatBottom","LineToolIcon","LineToolEmoji","LineToolSticker","LineToolRotatedRectangle","LineToolFibSpiral","LineToolHeadAndShoulders","LineToolTriangle","LineToolTrianglePattern","LineTool5PointsPattern","LineToolThreeDrivers","LineToolABCD","LineToolPolyline","LineToolPath","LineToolPrediction","LineToolPriceLabel","LineToolPriceNote","LineToolTextNote","LineToolNote","LineToolNoteAbsolute","LineToolArrowMarker","LineToolSignpost","LineToolBrush","LineToolArc","LineToolCallout","LineToolBalloon","LineToolComment","LineToolText","LineToolHorzLine","LineToolHorzRay","LineToolRectangle","LineToolCircle","LineToolEllipse","LineToolTimeCycles","LineToolSineLine","LineToolGhostFeed","LineToolBezierQuadro","LineToolBezierCubic","LineToolArrow","LineToolRay","LineToolExtended","LineToolSchiffPitchfork","LineToolSchiffPitchfork2","LineToolInsidePitchfork","LineToolTextAbsolute","LineToolArrowMarkLeft","LineToolArrowMarkRight","LineToolArrowMarkUp","LineToolArrowMarkDown","LineToolFlagMark","LineToolCypherPattern","LineToolElliottImpulse","LineToolElliottTriangle","LineToolElliottTripleCombo","LineToolElliottCorrection","LineToolElliottDoubleCombo","LineToolRiskRewardLong","LineToolRiskRewardShort","LineToolPosition","LineToolOrder","LineToolHighlighter","LineToolTable"]);function s(e){return n.has(e)}function o(e){return"LineToolRegressionTrend"===e||"LineToolVbPFixed"===e||"LineToolFixedRangeVolumeProfile"===e||"LineToolAnchoredVolumeProfile"===e||"LineToolAnchoredVWAP"===e}function a(e){return r.has(e)||o(e)}function l(e){return"LineToolBrush"===e||"LineToolHighlighter"===e}function u(e){return l(e)||"LineToolPath"===e||"LineToolPolyline"===e||"LineToolGhostFeed"===e}function d(e){return"LineToolTweet"===e||"LineToolIdea"===e||"LineToolImage"===e}function c(e){return"LineToolImage"===e}function p(e){switch(e){case"LineToolBalloon":case"LineToolComment":case"LineToolText":
case"LineToolTextAbsolute":case"LineToolCallout":case"LineToolNote":case"LineToolNoteAbsolute":case"LineToolSignpost":return!0}return!1}r.add("LineToolImage"),r.add("LineToolTweet"),r.add("LineToolIdea")},475892:(e,t,i)=>{"use strict";i.d(t,{PriceDataSource:()=>a,isPriceDataSource:()=>o});var n=i(903424),r=i(942634),s=i(487945);function o(e){return e instanceof a}class a extends n.DataSource{constructor(e,t){super(t),this._formatterChanged=new r.Delegate,this._priceStepChanged=new r.Delegate,this._currencyChanged=new r.Delegate,this._unitChanged=new r.Delegate,this._priceRangeReadyChanged=new r.Delegate,this._priceStep=null,this._priceRangeReady=!0,this._model=e}base(){return 0}model(){return this._model}currencyChanged(){return this._currencyChanged}isCurrencySource(){return!0}isDisplayedInLegend(){return!0}unitChanged(){return this._unitChanged}isUnitSource(){return!0}priceRange(e,t,i){return null}isDraggable(){return!0}priceLineColor(e){return e}formatterChanged(){return this._formatterChanged}priceStep(e){return this._priceStep}priceStepChanged(){return this._priceStepChanged}isIncludedInAutoScale(){return!0}correctScaleMargins(e){return e}priceRangeReady(){return this._priceRangeReady}priceRangeReadyChanged(){return this._priceRangeReadyChanged}disablePriceRangeReady(){const e=this.priceScale();null===e||e.isAutoScale()||e.mainSource()!==this||(this._priceRangeReady=!1,e.recalculatePriceRangeOnce()),this._priceRangeReadyChanged.fire(!1)}statusView(){return null}legendView(){return null}marketStatusModel(){return null}dataUpdatedModeModel(){return null}dataProblemModel(){return null}canHasAlertOnLineTools(){return!0}_enablePriceRangeReady(){this._priceRangeReady=!0,this._priceRangeReadyChanged.fire(!0)}_onSourceCurrencyChanged(){(0,s.isActingAsSymbolSource)(this)||this._currencyChanged.fire()}_onSourceUnitChanged(){(0,s.isActingAsSymbolSource)(this)||this._unitChanged.fire()}_onSourcePriceRangeReadyChanged(e){(0,s.isActingAsSymbolSource)(this)||e||this.disablePriceRangeReady()}}},923451:(e,t,i)=>{"use strict";i.d(t,{iterateAndPatchObjectsByMap:()=>h,patchPropertiesAsync:()=>p,processLegacy:()=>f});var n=i(650151),r=i(338619),s=i(79200),o=i(955273),a=i(345848),l=i(603774),u=i(453995),d=i(486393);const c=(0,r.getLogger)("Pine.ScriptLib");function p(e,t,i,n){return c.logNormal("patchPropertiesAsync"),new Promise(((o,l)=>{if(!t.TVScriptMetaInfoExprs)return void o(e);const c=t.TVScriptMetaInfoExprs.tree,p=t.TVScriptMetaInfoExprs.patchMap;(function(e,t){(0,a.trackEvent)("Pine","ScriptLib.evalMetaInfoExprs");const i=d.Deferred(),n={username:window.user&&window.user.username,source:e,inputs:JSON.stringify(t||{})};return(0,u._pineFacadeAjax)("POST","/eval_pine_ex/",n).done(((e,t)=>{e.error?i.reject((0,u._readableError)(e.error,t)):e.success?i.resolve(e.result):i.reject((0,u.safetyGetReason)(e))})).fail((e=>{(0,u._anyRequestAsyncFail)(i,e)})),i.promise()})(c,i).done((i=>{if(!i)return void o(e);const a=e.childs().inputs.childs().text.value(),l=i.rootValues;h([e,t.defaults,t],p,((e,t,i)=>{const r=l[i],s=e[0],o=e[1],a=e[2]
;(void 0===n||void 0!==n[i]&&n[i]!==r)&&(o.hasOwnProperty(t)?s[t].setValue(r):a[t]=r)})),void 0!==n&&Object.keys(l).forEach((e=>{void 0!==n[e]&&(n[e]=l[e])}));const u=e.childs().inputs.childs().text.value();a&&!u&&(0,s.getPersistentLogger)()?.addPersistentLogEntry(`Detected invalid meta info evaluation expression result: IL code input value is empty, id: ${t.fullId}`,r.LOGLEVEL.ERROR,"PineMetaInfoValidation"),o(e)})).fail((e=>{l(e)}))}))}function h(e,t,i){const r=Object.keys(t);for(let s=0;s<r.length;s++){const o=r[s],a=t[o],l=o.split(".");"defaults"===l[0]&&l.splice(0,1),(0,n.assert)(l.length>1,"Unexpectedly short json path");let u=[...e];for(let e=0;e<l.length-1;++e){const t=l[e];u=u.map((e=>e?e[t]:null))}i(u,l[l.length-1],a)}}function f(e,t){(0,a.trackEvent)("Pine","ScriptLib.processLegacy");const i=(0,o.createDeferredPromise)(),n=window.user&&window.user.username,r="/process_legacy/"+encodeURIComponent(e)+"/?user_name="+encodeURIComponent(n),s=t?{source:t}:{};return(0,u._pineFacadeAjax)("POST",r,s).done((e=>{e.error?i.reject((0,u._readableError)(e.error)):e.success?((0,l.logPineMetaInfoIssues)("ScriptLib.processLegacy",e.result.metaInfo),i.resolve(e.result.metaInfo)):i.reject((0,u.safetyGetReason)(e))})).fail((e=>{(0,u._anyRequestAsyncFail)(i,e)})),i.promise}},453995:(e,t,i)=>{"use strict";var n=i(486393),r=i(345848).trackEvent,s=i(338619).getLogger("Pine.ScriptLib"),o=i(175203).telemetry,a={fast:["delete","get","is_auth_to_get","is_auth_to_write","parse_title","rename","lib_list"],medium:["list","eval_pine_ex","translate_light"],slow:["process_legacy","publish","save","translate","translate_source","gen_alert"]},l=/[l|L]ines? (\d*)/;function u(e){if("object"==typeof e.reason)return e.reason;if(e.reason2)return e.reason2;const t={errors:[],warnings:[]},i=e.result&&e.result.metaInfo;if(i&&void 0!==i.warnings&&i.warnings.forEach((e=>t.warnings.push({message:e}))),e.reason){(Array.isArray(e.reason)?e.reason:e.reason.split("\n")).forEach((e=>{const i=e.match(l),n=i&&i.length&&Number(i[1]),r={message:e};if("number"==typeof n){r.start={line:n,column:0};const e=r.message.split(": ");e.shift(),r.message=e.join(": ")}t.errors.push(r)}))}return t}var d={getPineFacadeUrl:function(){return window.PINE_URL},PINE_FACADE_URL:function(){return window.PINE_URL}};d.safetyGetReason=u,d._pineFacadeAjax=function(e,t,i,r){s.logNormal("Requesting pine facade scripts, url: "+t);var l=function(e){for(var t=Object.keys(a),i=0;i<t.length;i++){var n=a[t[i]].filter((function(t){return-1!==e.indexOf(t)}));if(Boolean(n.length))return t[i]}return!1}(t),u=Date.now(),c=r?void 0:{withCredentials:!0};return n.ajax({url:d.PINE_FACADE_URL()+t,type:e,data:i||{},dataType:"json",xhrFields:c}).done((function(){var e=Date.now()-u;o.sendReport("pine",l+"_group_time_frame",{value:e}),o.sendReport("pine",l+"_group_ok"),s.logNormal("Requesting pine facade scripts finished, url: "+t)})).fail((function(){var e=Date.now()-u;o.sendReport("pine",l+"_group_time_frame",{value:e}),o.sendReport("pine",l+"_group_error"),
s.logError("Requesting pine facade scripts failed, url: "+t)}))},d._generateAlertAsyncDone=function(e,t){if(t.error)e.reject(d._readableError(t.error));else if(t.success)e.resolve(t.result.metaInfo,t.result.IL,t.result.inputs||null,t.result.gen_alert_data||null);else{var i=t.result?t.result.metaInfo:null;e.reject(u(t),i)}},d._readableError=function(e,t){return t},d._anyRequestAsyncFail=function(e,t){try{const i=u(JSON.parse(t.responseText));if(i)return e.reject(i)}catch(e){}0===d.PINE_FACADE_URL().indexOf("http")&&s.logError(t.responseText),e.reject(d._readableError(t.status,t.statusText))},d.getPineSourceCode=function(e,t,i){r("Pine","ScriptLib.getPineSourceCode");var s=n.Deferred(),o="?no_4xx="+!!i,a="/get/"+encodeURIComponent(e)+"/"+t+o;return d._pineFacadeAjax("GET",a).done((function(e,t,i){!1===e.success?s.reject(u(e)):s.resolve(e)})).fail((function(e,t,i){d._anyRequestAsyncFail(s,e)})),s.promise()},d.generateAlert=function(e){r("Pine","ScriptLib.generateAlert");var t=n.Deferred(),i=window.user&&window.user.username,s="/gen_alert/?user_name="+encodeURIComponent(i),a={alert_info:e},l=Date.now();return d._pineFacadeAjax("POST",s,a).done((function(e,i,n){o.sendReport("alerts","compilation_ok"),d._generateAlertAsyncDone(t,e)})).fail((function(e,i,n){o.sendReport("alerts","compilation_error"),d._anyRequestAsyncFail(t,e)})).always((function(){var e=Date.now()-l;o.sendReport("alerts","compilation_time_frame",{value:e})})),t.promise()},d.scriptUpdater=function(){return window.scriptUpdater()},d.requestUserPublishedScripts=function(e,t){if(r("Pine","ScriptLib.requestUserPublishedScripts"),window.is_authenticated){if(t||!d._userPublishedScriptsDfd){d._userPublishedScriptsDfd=n.Deferred();var i=d._userPublishedScriptsDfd;d._pineFacadeAjax("GET","/list?filter=published").done((function(e,t,n){i.resolve(e)})).fail((function(e){d._anyRequestAsyncFail(i,e)}))}i=d._userPublishedScriptsDfd}else i=n.Deferred().resolve([]);return"function"==typeof e&&i.done(e),i.promise()},d.requestInfoForScripts=function(e){return Promise.all([d._pineFacadeAjax("GET","/list?filter=saved"),d._pineFacadeAjax("GET","/list?filter=addon",void 0,!0)]).then((function(t){var i=t[0],n=t[1];return i.concat(n).filter((function(t){return e.includes(t.scriptIdPart)}))}))},d.requestBuiltinAndUserScripts=function(){r("Pine","ScriptLib.requestBuiltinAndUserScripts"),s.logNormal("Request built-in and user scripts");var e,t=window.user&&window.user.username,i={},n=new Promise((function(t,n){e=t,i.reject=n}));return Promise.all([d._pineFacadeAjax("GET","/list?filter=saved&user_name="+encodeURIComponent(t),void 0,!1),d._pineFacadeAjax("GET","/list?filter=standard",void 0,!0)]).then((function(t){s.logNormal("Request built-in and user scripts finished");var i=t[0],n=t[1];e(i.concat(n))})).catch((function(e){s.logWarn("Request built-in and user scripts finished with fail"),d._anyRequestAsyncFail(i,e)})),n},d.requestScriptInfo=function(e){r("Pine","ScriptLib.requestBuiltinAndUserScripts"),s.logNormal("Request public/user script info");var t=n.Deferred()
;return d._pineFacadeAjax("GET","/get_script_info/?pine_id="+encodeURIComponent(e)).done((function(e){s.logNormal("Request public/user script info finished"),t.resolve(e)})).fail((function(e){s.logWarn("Request public/user script info finished with fail"),d._anyRequestAsyncFail(t,e)})),t.promise()},d.requestCandlestickScripts=function(){var e;r("Pine","ScriptLib.requestCandlestickScripts"),s.logNormal("Request candlestick scripts");var t={},i=new Promise((function(i,n){e=i,t.reject=n}));return d._pineFacadeAjax("GET","/list?filter=candlestick",void 0,!0).done((function(t){s.logNormal("Request candlestick scripts finished"),e(t)})).fail((function(e){s.logWarn("Request candlestick scripts finished with fail"),d._anyRequestAsyncFail(t,e)})),i};var c={time:-1/0,request:null};d.requestFundamentalScripts=function(){if(c.time+6e5>Date.now()&&null!==c.request)return s.logNormal("Return fundamentals from cache"),c.request;s.logNormal("Request fundamental scripts");var e=d._pineFacadeAjax("GET","/list?filter=fundamental",void 0,!1);return e.then((function(e){s.logNormal("Request fundamental scripts finished")})),e.fail((function(e){s.logWarn("Request fundamental scripts finished with fail, resetting cache"),c.request=null})),c.time=Date.now(),c.request=Promise.resolve(e.promise()),c.request},d.publishNew=function(e,t,i,s){r("Pine","ScriptLib.publishNew");var o=n.Deferred(),a=window.user&&window.user.username,l="/publish/new/?access="+encodeURIComponent(t)+"&user_name="+encodeURIComponent(a),c={source:e,extra:JSON.stringify({originalScriptId:i,originalScriptVersion:s})};return d._pineFacadeAjax("POST",l,c).done((function(e,t,i){e.success?o.resolve(e):o.reject(u(e))})).fail((function(e,t,i){d._anyRequestAsyncFail(o,e)})),o.promise()},d.publishNext=function(e,t,i,o){s.logNormal("ScriptLib.publishNext","pine"),r("Pine","ScriptLib.publishNext");var a=n.Deferred(),l=window.user&&window.user.username,c="/publish/next/"+encodeURIComponent(t)+"?user_name="+encodeURIComponent(l),p={source:e,extra:JSON.stringify({originalScriptId:i,originalScriptVersion:o})};return d._pineFacadeAjax("POST",c,p).done((function(e,t,i){e.success||a.reject(u(e)),a.resolve(e)})).fail((function(e,t,i){d._anyRequestAsyncFail(a,e)})),a.promise()},d.lightTranslate=function(e,t){return s.logNormal("ScriptLib.lightTranslate","pine"),r("Pine","ScriptLib.lightTranslate"),new Promise((function(i,n){var r=window.user&&window.user.username,s=`/translate_light/?user_name=${encodeURIComponent(r)}`;t&&(s+=`&pine_id=${encodeURIComponent(t)}`);var o={source:e};d._pineFacadeAjax("POST",s,o).done((function(e,t,r){if(e.success)i(e.result);else{var s=e.result&&u(e.result)||u(e);n(s)}})).fail((function(e,t,i){d._anyRequestAsyncFail({reject:n},e)}))}))},d.getLibList=function(e,t,i){return s.logNormal("ScriptLib.getLibList","pine"),r("Pine","ScriptLib.getLibList"),new Promise((function(n,r){var s="/lib_list?lib_id_prefix="+encodeURIComponent(e);t&&(s+="&ignore_cache=true"),i&&(s+="&ignore_case=true"),d._pineFacadeAjax("GET",s).done((function(e,t,i){n(e)})).fail((function(e,t,i){
d._anyRequestAsyncFail({reject:r},e)}))}))},d.getExistingLibraryInfo=async function(e){try{const t=await d.getLibList(e+"/last",!0,!0);if(!t.length)return null;const i=t[0];return{scriptIdPart:i.scriptIdPart,chartId:i.chartId,version:i.version}}catch(e){return null}},e.exports=d},901110:(e,t,i)=>{"use strict";i.d(t,{StatusProviderBase:()=>n});class n{size(){return"13px"}bold(){return!1}}},32904:(e,t,i)=>{"use strict";i.d(t,{StatusView:()=>n});class n{constructor(e){this._text="",this._color="",this._size="13px",this._bold=!1,this._statusProvider=e}text(){return this._text}getSplitTitle(){return[this._text]}bold(){return this._bold}size(){return this._size}}},874546:(e,t,i)=>{"use strict";i.d(t,{migrateMetaInfoAndPropState:()=>d});var n=i(650151),r=i(637761),s=i(124829);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"],a=["DoubleTopCP@tv-basicstudies","BullishFlagCP@tv-basicstudies","HeadAndShouldersCP@tv-basicstudies","TripleTopCP@tv-basicstudies"];class l{targetMetaInfoVersion(){return 53}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=53,void 0!==t.defaults&&void 0!==t.defaults.inputs&&(o.includes(t.id)||a.includes(t.id)&&Number(t.version)<156)){const e=t.defaults.inputs["Invert Pattern"];i.id=this._getNewIdStudies(t.id,e)}}migratePropState(e){}_getNewIdStudies(e,t){return e.startsWith("WedgeCP")?t?"WedgeFallingCP@tv-basicstudies":"WedgeRisingCP@tv-basicstudies":e.startsWith("PennantCP")?t?"PennantBearishCP@tv-basicstudies":"PennantBullishCP@tv-basicstudies":e.startsWith("DoubleTopCP")&&t?"DoubleBottomCP@tv-basicstudies":e.startsWith("BullishFlagCP")&&t?"BearishFlagCP@tv-basicstudies":e.startsWith("HeadAndShouldersCP")&&t?"HeadAndShouldersInverseCP@tv-basicstudies":e.startsWith("TripleTopCP")&&t?"TripleBottomCP@tv-basicstudies":e}}const u=[new class{targetMetaInfoVersion(){return 47}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=47,!t.defaults||void 0===t.defaults.precision)return void(i.format={type:"inherit"});const n=t.defaults&&t.defaults.precision,r=(0,s.isNumber)(n)?n:parseInt(n);0===r?i.format={type:"volume"}:isFinite(r)?i.format={type:"price",precision:r}:i.format={type:"inherit"},delete t.defaults.precision}migratePropState(e){}},new class{targetMetaInfoVersion(){return 50}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=50,void 0===t.defaults||void 0===t.defaults.ohlcPlots||void 0===t.ohlcPlots)return;const r=t.ohlcPlots,s=t.defaults.ohlcPlots,o=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).ohlcPlots);for(const e of Object.keys(s)){const t=s[e];if("ohlc_candles"===t.plottype){let i=!1;const n=r[e];void 0!==n&&(i=!!n.drawBorder,delete n.drawBorder),o[e]={borderColor:"#000000",drawBorder:i,...t}}}}migratePropState(e){}},new class{targetMetaInfoVersion(){return 53}migrateMetaInfo(e){const t=e,i=e;if(i._metainfoVersion=53,void 0!==t.defaults){if(void 0!==t.defaults.ohlcPlots&&void 0!==t.ohlcPlots){const e=Object.keys(t.ohlcPlots),r=t.defaults.ohlcPlots,s=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).ohlcPlots);for(const t of e){const e=r[t]
;if(void 0===e||void 0===e.visible)continue;const i=e.visible?15:0;delete e.visible,s[t]={display:i,...e}}}if(void 0!==t.defaults.styles&&void 0!==t.plots){const e=t.plots.map((e=>e.id)),r=t.defaults.styles,s=(0,n.ensureDefined)((0,n.ensureDefined)(i.defaults).styles);for(const t of e){const e=r[t];if(void 0===e||void 0===e.visible)continue;const i=e.visible?15:0;delete e.visible,s[t]={display:i,...e}}}}}migratePropState(e){if(e.ohlcPlots)for(const t of Object.keys(e.ohlcPlots)){const i=(0,n.ensureDefined)(e.ohlcPlots[t]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}if(e.styles)for(const t of Object.keys(e.styles)){const i=(0,n.ensureDefined)(e.styles[t]);void 0!==i.visible&&(i.display=i.visible?15:0,delete i.visible)}}}];function d(e,t){const i=r.StudyMetaInfo.versionOf(e),s=e;void 0===s._serverMetaInfoVersion&&(s._serverMetaInfoVersion=i);const o=["PennantCP@tv-basicstudies","WedgeCP@tv-basicstudies"].includes(e.id);u.forEach((r=>{(i<0||i>=r.targetMetaInfoVersion())&&!o||(r.migrateMetaInfo(e),void 0!==t&&r.migratePropState(t),(0,n.assert)(e._metainfoVersion===r.targetMetaInfoVersion()))}))}u.push(new l),u.sort((function(e,t){return e.targetMetaInfoVersion()-t.targetMetaInfoVersion()}))},879938:(e,t,i)=>{"use strict";function n(e,t="shift",i){return{studyConstructorAsyncGetter:e,colorRotationMode:t,colorRotationComparator:i}}i.d(t,{addStudyInfoToMap:()=>s,createStudyInfo:()=>n,getStudyClassName:()=>a,getStudyInfoByName:()=>o});const r=new Map;function s(e,t){r.set(e,t)}function o(e){return r.get(e)}function a(e){for(const[t,i]of r.entries())if(i.studyConstructor===e)return t;return null}},218049:(e,t,i)=>{"use strict";i.d(t,{ChartColorDependentStudyInputNames:()=>p,InputDisplayFlags:()=>n,RangeDependentStudyInputNames:()=>c,areStudyInputsEqual:()=>d,editableStudyInputs:()=>y,getInputValue:()=>a,isExtendedInput:()=>s,isExtendedInputSource:()=>o,isStudyInputDependsOnChart:()=>v,isStudyInputDependsOnChartColors:()=>g,isStudyInputOptionsInfo:()=>u,isTimeOrPriceNotHiddenInput:()=>f,rangeDependentStudyInputsToTimeRange:()=>h,studyAvailableConstSources:()=>l});var n,r=i(182433);function s(e){return(0,r.default)(e)}function o(e){return"source"===e.t}function a(e){return s(e)?e.v:e}!function(e){e[e.None=0]="None",e[e.DataWindow=2]="DataWindow",e[e.StatusLine=8]="StatusLine",e[e.All=15]="All"}(n||(n={}));const l=["open","high","low","close","hl2","hlc3","ohlc4","hlcc4"];function u(e){return["text","integer","float","price","session","resolution"].includes(e.type)&&e.hasOwnProperty("options")}function d(e,t,i){for(const n of e)if(t[n.id]!==i[n.id])return!1;return!0}var c,p;function h(e){return{from:Math.round(e.first_visible_bar_time/1e3),to:Math.round(e.last_visible_bar_time/1e3)}}function f(e){return("time"===e.type||"price"===e.type)&&!0!==e.isHidden}function y(e){const t=e.filter(f);if(0===t.length)return[];const i=new Map,n=[];t.forEach((e=>{const{group:t,inline:r}=e;if(void 0===r)return void n.push(e);const s=r+(t||"");if(i.has(s))i.get(s)?.push(e);else{const t=[e];i.set(s,t),n.push(t)}}));const r=[]
;for(let e=0;e<n.length;e++){const t=n[e];Array.isArray(t)?2===t.length&&t[0].type!==t[1].type?r.push(t):r.push(...t):r.push(t)}return r}function g(e){return Object.values(p).map((e=>e)).includes(e.id)}function v(e){return!!g(e)||Object.values(c).map((e=>e)).includes(e.id)}!function(e){e.FirstBar="first_visible_bar_time",e.LastBar="last_visible_bar_time",e.Realtime="subscribeRealtime"}(c||(c={})),function(e){e.FgColor="__chart_fgcolor",e.BgColor="__chart_bgcolor"}(p||(p={}))},296842:(e,t,i)=>{"use strict";i.d(t,{fundamentalsPrefix:()=>n,isFundamentalStudyMetaInfo:()=>r,studyNameByMetaInfo:()=>s});const n="study_Internal$STD;Fund_";function r(e){return s(e)===n}function s(e){const t="study_"+(e.classId||e.shortId);return t.startsWith(n)?n:t}},170411:(e,t,i)=>{"use strict";i.d(t,{StudyStatusProviderBase:()=>l});var n=i(901110),r=i(757402),s=i(287741);const o={NONE:"Default"},a=!0;class l extends n.StatusProviderBase{constructor(e){super(),this._source=e}getSplitTitle(){return this._source.titleInParts(s.TitleDisplayTarget.StatusLine,!0,o,void 0,a)}text(){return this._source.isActualInterval()?this._source.isFailed()?`${this._source.title(s.TitleDisplayTarget.StatusLine,!0,o,void 0,a)}: ${this.sourceStatusText()}`:`${this._source.title(s.TitleDisplayTarget.StatusLine,!0,o,void 0,a)} ${this.sourceStatusText()}`:this._source.title(s.TitleDisplayTarget.StatusLine,!0,o,void 0,a)}sourceStatusText(){return(0,r.convertStudyStatusToString)(this._source.status(),!0)}errorStatus(){if(!this._source.isActualInterval()||this._source.isSymbolInvalid())return null;const e=this._source.status();return e.type===r.StudyStatusType.Error?{error:this.sourceStatusText(),solutionId:(0,r.studyStatusSolutionId)(e),title:(0,r.studyStatusTitle)(e),studyFeature:(0,r.studyStatusFeature)(e),stackTrace:(0,r.studyErrorStatusStackTrace)(e.errorDescription.stack_trace),editorError:e.errorDescription.editorError}:null}}},323719:(e,t,i)=>{"use strict";i.d(t,{StudyStatusView:()=>r});var n=i(32904);class r extends n.StatusView{constructor(e){super(e.statusProvider())}getSplitTitle(){return this._statusProvider.getSplitTitle()}update(){this._text=this._statusProvider.text()}}},872842:(e,t,i)=>{"use strict";i.d(t,{StudyStub:()=>b,isStudyStubDescriptor:()=>L});var n=i(650279),r=i(130551),s=i(650151),o=i(120984),a=i(375397),l=i(643322),u=i(322825),d=i(219849),c=i(323719),p=i(475892),h=i(735211),f=i(942634),y=i(658843),g=i(170411),v=i(287741);class S extends g.StudyStatusProviderBase{text(){return this._source.isActualInterval()?`${this._source.title(v.TitleDisplayTarget.StatusLine)} ${this.sourceStatusText()}`:this._source.title(v.TitleDisplayTarget.StatusLine)}}var _=i(757402),m=i(198930),I=i(850723);class T{getItems(){return[]}getValues(e){return[]}}const P=new f.Delegate;class b extends p.PriceDataSource{constructor(e,t,i,n,r=null){super(e),this._priceStep=.01,this._origState=null,this._descriptor=null,this._status={type:_.StudyStatusType.Undefined},this._statusChanged=new f.Delegate,this._descriptorChanged=new f.Delegate,
this._formatter=new h.PriceFormatter({priceScale:100}),this._showPineVersionInStatusLine=new a.WatchedValue(!1).spawn(),this._pineSourceCodeModel=null,(0,I.isStudyDescriptor)(t)?this._descriptor=t:this._origState=t,this._title=i,this._alwaysShowInLegend=void 0!==n,this._isOverlay=n,this._studyMetaInfo=r;this._properties=new y.Property({visible:!0}),this._statusView=new c.StudyStatusView(this),r&&(0,u.isCountedUserScript)(r)&&(this._showPineVersionInStatusLine=(0,l.combine)((()=>(0,u.userScriptVersionsCount)(r.scriptIdPart)>1),(0,u.userScriptsOnLayout)().weakReference()),this._showPineVersionInStatusLine.subscribe((()=>e.updateSource(this))))}destroy(){this._pineSourceCodeModel?.get()?.destroy(),this._pineSourceCodeModel?.destroy(),this._showPineVersionInStatusLine.destroy(),super.destroy()}barColorer(){return null}properties(){return this._properties}statusView(){return this._statusView}legendView(){return null}state(e){return this._origState}getDescriptor(){return null===this._descriptor?null:{descriptor:this._descriptor,title:this._title,isOverlay:this._isOverlay,id:this.id(),status:this._status}}updateDescriptor(e){(0,n.default)(this._descriptor,e)||(this._descriptor=e,this._descriptorChanged.fire())}onDescriptorChanged(){return this._descriptorChanged}metaInfo(){return this._studyMetaInfo}setMetaInfo(e){this._studyMetaInfo=e}setStatus(e){const t=this.isDisplayedInLegend();if(this._status=e,this._statusChanged.fire(),this.isDisplayedInLegend()!==t){const e=this._model.paneForSource(this);if(e){const t=this._model.panes().indexOf(e),i=d.InvalidationMask.invalidateLegendWidgetLayout(t);this.model().invalidate(i)}}}formatter(){return this._formatter}name(){return this._title}title(){return this.titleInParts().join(" ")}titleInParts(){const e=[this._title];return this._showPineVersionInStatusLine.value()&&e.push((0,s.ensureDefined)(this._studyMetaInfo?.pine).version),e}isFailed(){return this._status.type===_.StudyStatusType.Error}isLoading(){return this._status.type===_.StudyStatusType.Loading}isDisplayedInLegend(){return this._alwaysShowInLegend||this.isFailed()}setFailed(e){this.setStatus({type:_.StudyStatusType.Error,errorDescription:{error:e}}),this._model.updateSource(this)}isSymbolInvalid(){return!1}isActualInterval(){return!0}onIsActualIntervalChange(){return P}start(){}status(){return this._status}onStatusChanged(){return this._statusChanged}firstValue(){return null}currency(){return null}sessionId(){return this._model.mainSeries().sessionId()}sessionIdChanged(){return this._model.mainSeries().sessionIdChanged()}unit(){return null}symbolSource(){return this._model.mainSeries()}barsProvider(){return this._model.mainSeries()}legendValuesProvider(){return new T}statusProvider(e){return new S(this)}isRemovedByStudyTemplates(){return null!==this._origState&&(0,m.isStudyState)(this._origState)}pineSourceCodeModel(){
return null!==this._descriptor&&"pine"===this._descriptor.type?(this._pineSourceCodeModel||(this._pineSourceCodeModel=new o.AsyncResourceWrapper(Promise.all([i.e(89230),i.e(35980),i.e(97525),i.e(19719),i.e(65414),i.e(42095),i.e(26035),i.e(83005),i.e(89199)]).then(i.bind(i,437334)).then((e=>this._isDestroyed?null:new e.PineStubSourceCodeModel(this))))),this._pineSourceCodeModel.promise()):Promise.resolve(null)}}function L(e){return(0,r.isObject)(e)&&"descriptor"in e&&(0,I.isStudyDescriptor)(e.descriptor)}},406137:(e,t,i)=>{"use strict";i.d(t,{applyOverridesToStudyDefaults:()=>c});var n=i(650151),r=i(748947),s=i(338619);const o={line:r.LineStudyPlotStyle.Line,histogram:r.LineStudyPlotStyle.Histogram,cross:r.LineStudyPlotStyle.Cross,area:r.LineStudyPlotStyle.Area,columns:r.LineStudyPlotStyle.Columns,circles:r.LineStudyPlotStyle.Circles,line_with_breaks:r.LineStudyPlotStyle.LineWithBreaks,area_with_breaks:r.LineStudyPlotStyle.AreaWithBreaks,step_line:r.LineStudyPlotStyle.StepLine,step_line_with_breaks:r.LineStudyPlotStyle.StepLineWithBreaks,step_line_with_diamonds:r.LineStudyPlotStyle.StepLineWithDiamonds},a=(0,s.getLogger)("Chart.Model.StudyPropertiesOverrider");var l,u;function d(e,t,i,n){const r=i.split(".");if(0===r.length||0===r[0].length)return;const s=function(e){const t=e.split(":");return{name:t[0],type:2===t.length?t[1]:null}}(r[0]),o=s.name,d=s.type,c=null!==d,p=!c||"band"===d,h=!c||"area"===d,f=!c||"input"===d,y=!c||"plot"===d?u.getPlotIdByTitle(e,o):null,g=p?u.getBandIndexByName(e,o):null,v=h?u.getFilledAreaIdByTitle(e,o):null,S=f?u.getInputByName(e,o):null,_=t.hasOwnProperty(o);if((null!==y?1:0)+(null!==g?1:0)+(null!==v?1:0)+(null!==S?1:0)+(_?1:0)>1)return void a.logWarn(`Study '${e.description}' has ambiguous identifier '${o}'`);const m=r[1];if(null!==y){if(1===r.length)return void a.logWarn(`Path of sub-property of '${o}' plot for study '${e.description}' must be not empty`);const i=r.slice(1);l.applyPlotProperty(e,t,y,i,n)}else if(null!==S)l.applyInputValue(t,S,n);else if(null!==g){if(void 0===m)return void a.logWarn(`Property name of '${o}' band for study '${e.description}' must be set`);l.applyBandProperty(t,g,m,n)}else if(null!==v){if(void 0===m)return void a.logWarn(`Property name of '${o}' area for study '${e.description}' must be set`);l.applyFilledAreaProperty(t,v,m,n)}else _?l.setRootProperty(t,r,n):a.logWarn(`Study '${e.description}' has no plot or input '${o}'`)}function c(e,t,i){for(const n in e){if(!e.hasOwnProperty(n))continue;const r=n.indexOf(".");if(-1===r)continue;const s=n.substring(0,r),o=u.getMetaInfoByDescription(t,s);if(null===o){a.logWarn(`There is no such study ${s}`);continue}const l=i(o);null!==l?d(o,l,n.substring(r+1),e[n]):a.logWarn(`Cannot apply overrides for study ${s}`)}}!function(e){e.applyPlotProperty=function(e,t,i,s,l){if(void 0===t.styles)return void a.logWarn("Study does not have styles");const u=s[0];if("color"===u){const o=function(e,t,i){if(void 0===e.plots)return null;for(const n of e.plots){if(!(0,r.isPaletteColorerPlot)(n)||void 0===t.palettes)continue
;const e=t.palettes[n.palette];if(n.target===i&&void 0!==e)return e}return null}(e,t,i);return void function(e,t,i,r,s){void 0!==e.styles?null===t&&!isNaN(r)&&r>0?a.logWarn(`Study plot does not have color #${r}`):((0===r||isNaN(r))&&((0,n.ensureDefined)(e.styles[i]).color=String(s),r=0),null!==t&&((0,n.ensureDefined)(t.colors?.[r]).color=String(s))):a.logWarn("Study does not have styles")}(t,o,i,s.length>1?parseInt(s[1]):NaN,l)}const d=t.styles[i];if(void 0!==d&&d.hasOwnProperty(u)){if("plottype"===u){const e=o[String(l)];if(void 0===e)return void a.logWarn(`Unsupported plot type for plot: ${l}`);l=e}d[u]=l}else a.logWarn(`Study plot does not have property '${u}'`)},e.applyBandProperty=function(e,t,i,n){if(void 0===e.bands)return void a.logWarn("Study does not have bands");const r=e.bands[t];if(void 0!==r&&r.hasOwnProperty(i)){if("plottype"===i){const e=o[String(n)];if(void 0===e)return void a.logWarn(`Unsupported plot type for band: ${n}`);n=e}r[i]=n}else a.logWarn(`Study band does not have property '${i}'`)},e.applyFilledAreaProperty=function(e,t,i,n){if(void 0===e.filledAreasStyle)return void a.logWarn("Study does not have areas");const r=e.filledAreasStyle[t];void 0!==r&&r.hasOwnProperty(i)?r[i]=n:a.logWarn(`Study area does not have property '${i}'`)},e.applyInputValue=function(e,t,i){void 0!==e.inputs&&e.inputs.hasOwnProperty(t)?e.inputs[t]=i:a.logWarn(`Study does not have input '${t}'`)},e.setRootProperty=function(e,t,i){if(0===t.length)return;let n=e;for(const e of t.slice(0,-1)){if(null==n||!n.hasOwnProperty(e))break;n=n[e]}const r=t[t.length-1];null!=n&&n.hasOwnProperty(r)?n[r]=i:a.logWarn(`Study does not have property ${t.join(".")}`)}}(l||(l={})),function(e){e.getInputByName=function(e,t){if(void 0===e.inputs)return null;t=t.toLowerCase();for(const i of e.inputs)if(i.name.toLowerCase()===t)return i.id;return null},e.getPlotIdByTitle=function(e,t){if(void 0===e.styles)return null;t=t.toLowerCase();for(const i in e.styles){const n=e.styles[i];if((void 0!==n&&void 0!==n.title?n.title:i).toLowerCase()===t)return i}return null},e.getFilledAreaIdByTitle=function(e,t){if(void 0===e.filledAreas)return null;t=t.toLowerCase();for(const i of e.filledAreas)if(i.title.toLowerCase()===t)return i.id;return null},e.getBandIndexByName=function(e,t){if(void 0===e.bands)return null;t=t.toLowerCase();for(let i=0;i<e.bands.length;++i)if(e.bands[i].name.toLowerCase()===t)return i;return null},e.getMetaInfoByDescription=function(e,t){t=t.toLowerCase();for(const i of e)if(i.description.toLowerCase()===t||i.shortDescription.toLowerCase()===t)return i;return null}}(u||(u={}))},382318:(e,t,i)=>{"use strict";var n=i(306060).Version,r=i(338619).getLogger("Chart.StudyMigration");function s(e){this._studyId=e,this._maxToVers=n.ZERO,this._maxFromVers=n.ZERO,this._migrs=[]}s.prototype.addMigration=function(e,t,i){var r=n.parse(e),s=n.parse(t);r.isGreater(this._maxFromVers)&&(this._maxFromVers=r),s.isGreater(this._maxToVers)&&(this._maxToVers=s),this._migrs.push({fromVers:r,toVers:s,rules:i})},s.prototype.updateInputs=function(e,t,i){
if(!i)return i;for(var n=TradingView.clone(i),s=e;s.isLess(t);){var o=this._findMigration(s);if(null==o)break;if(r.logNormal("Migrating study inputs from "+o.fromVers+" to "+o.toVers+" version, studyId: "+this._studyId+", migration: "+JSON.stringify(o)+", inputs: "+JSON.stringify(i)),n=this._applyMigration(n,o),!s.isLess(o.toVers))throw new Error("Problems in study migration process... Possible infinite cycle has been detected and stopped.");s=o.toVers}return s>e&&r.logNormal("Study inputs migration is done, studyId: "+this._studyId+", inputs: "+JSON.stringify(n)),n},s.prototype._findMigration=function(e){for(var t=-1,i=this._maxFromVers,n=0;n<this._migrs.length;n++){var r=this._migrs[n];r.fromVers.isLess(e)||r.fromVers.isLessOrEqual(i)&&(i=r.fromVers,t=n)}return t<0?null:this._migrs[t]},s.prototype._applyMigration=function(e,t){for(var i=e,n=0;n<t.rules.length;n++){var r=t.rules[n];i=this._getApplyRuleFun(r.type)(i,r)}return i},s.prototype._getApplyRuleFun=function(e){if("inputRemoved"===e)return s._applyInputRemovedRule;if("inputChangedType"===e)return s._applyInputChangedTypeRule;if("inputChangedMinMax"===e)return s._applyInputChangedMinMaxRule;if("inputChangedOptions"===e)return s._applyInputChangedOptionsRule;throw new Error("Unknown migration rule type: "+e)},s._applyInputRemovedRule=function(e,t){if(!(t.inputId in e))return e;if("removeVal"!==t.action)throw new Error("Unexpected rule.action="+t.action+" in rule.type="+t.type);var i=e[t.inputId];return delete e[t.inputId],r.logNormal("Input "+t.inputId+"="+i+" removed"),e},s._applyInputChangedTypeRule=function(e,t){var i=e[t.inputId];if("resetToDefVal"===t.action)return e[t.inputId]=t.defVal,r.logNormal("Input "+t.inputId+"="+i+" reset to default value "+t.defVal),e;if("convertVal"===t.action){if(null==i)return e;if("float"===t.inputTypeFrom&&"integer"===t.inputType)return e[t.inputId]=Math.round(e[t.inputId]),r.logNormal("Input "+t.inputId+"="+i+" converted to value "+e[t.inputId]),e;if("integer"===t.inputTypeFrom&&"float"===t.inputType)return e;if("text"===t.inputTypeFrom&&"source"===t.inputType)return s._isValidSource(i,t.options)||(e[t.inputId]=t.defVal),e;throw new Error("Cannot convertVal from "+t.inputTypeFrom+" to "+t.inputType)}throw new Error("Unknown action "+t.action+" for rule with type "+t.type)},s._isValidSource=function(e,t){return e.indexOf("$")>=0||t.indexOf(e)>=0},s._applyInputChangedMinMaxRule=function(e,t){if("adjustValIfNeeded"!==t.action)throw new Error("Unknown action "+t.action+" for rule with type "+t.type);var i=e[t.inputId];return i<t.minVal?e[t.inputId]=t.minVal:i>t.maxVal&&(e[t.inputId]=t.maxVal),r.logNormal("Input "+t.inputId+"="+i+" adjusted to value "+e[t.inputId]),e},s._applyInputChangedOptionsRule=function(e,t){if(!(["text"].indexOf(t.inputType)>=0&&"resetToDefValIfNeeded"===t.action))throw new Error("Unexpected rule.inputType="+t.inputType+" in rule.action="+t.action);var i=e[t.inputId];return t.options.indexOf(i)<0&&(e[t.inputId]=t.defVal,r.logNormal("Input "+t.inputId+"="+i+" reset to default value "+t.defVal)),e},
e.exports=s},500323:(e,t,i)=>{"use strict";i.d(t,{StudyVersioning:()=>_});var n=i(998034),r=i(650151),s=i(637761),o=i(382318),a=i.n(o),l=i(338619),u=i(306060),d=i(874546),c=i(870408),p=i(444372);var h=i(923451),f=i(971417),y=i(66974),g=i(124829);const v=(0,l.getLogger)("Chart.Study.Versioning"),S=1e12;class _{constructor(e,t){if(this._migrations={},!e)throw new Error("No studies metainfo");if(this._studiesMetainfo=e,!t)throw new Error("No studies migrations");this._studiesMigrations=t;for(let e=0;e<this._studiesMigrations.length;e++){const t=this._studiesMigrations[e],i=t.versFrom,n=t.versTo;for(let e=0;e<t.studyMigrations.length;e++){const r=t.studyMigrations[e],s=r.studyId;if(0===r.rules.length){v.logError("Study Migration should have at least one convertion rule");continue}const o=s in this._migrations?this._migrations[s]:new(a())(s);o.addMigration(i,n,r.rules),this._migrations[s]=o}}this._clientMigrations=[(e,t)=>{if(0===this._studiesMetainfo.length||!e.isTVScript||e.version>=22)return t;const i={};let n=0,r=0,s=t[r];for(;void 0!==s;){const e=t[s.id];s.isFake&&(s.id="in_"+n++),i[r]=s,i[s.id]=e,r++,s=t[r]}return i}]}updateMetaInfoAsync(e){const t=s.StudyMetaInfo.versionOf(e);if(e.isTVScript&&!e.pine&&t<43){(0,r.assert)((0,g.isExistent)(e.scriptIdPart),"scriptIdPart is missing, study "+JSON.stringify(e));const t=e.scriptIdPart;return{sync:!1,result:new Promise(((i,n)=>{(0,h.processLegacy)(t,e.TVScriptSourceCode).then((t=>{e.removeDefaults();const n=new s.StudyMetaInfo(t);n.createDefaults();const r=n.state();(0,d.migrateMetaInfoAndPropState)(r),i(new s.StudyMetaInfo(r))})).catch((e=>{n(e)}))}))}}if(e.isTVScript&&e.pine){if((e._serverMetaInfoVersion||t)<52){return{sync:!1,result:(0,c.translateScriptAsync2)(e.scriptIdPart,e.pine.version).then((t=>{e.removeDefaults();const i=new s.StudyMetaInfo(t.metaInfo);i.createDefaults();const n=i.state();return(0,d.migrateMetaInfoAndPropState)(n),new s.StudyMetaInfo(n)}))}}return e.createDefaults(),{sync:!0,result:e}}{let t=null;const i=this._studiesMetainfo;for(let n=0;n<i.length;n++)if(i[n].id===e.id){t=i[n];break}return{sync:!0,result:t?new s.StudyMetaInfo(t.state()):null}}}updateStudyState(e,t,i){if(null==e||null==t||null==i)return e;e=(0,g.clone)(e),this.updateStudyInputsIfNeeded(e,t.version,i);for(const i of this._clientMigrations){const n=i.call(this,t,e.inputs);Object.keys(n).length===Object.keys(e.inputs).length?e.inputs=n:v.logWarn("StudyVersioning._clientMigrations application returned bad result. Skipping it...")}const n=s.StudyMetaInfo.versionOf(t);if(t.isTVScript&&t.TVScriptSourceCode&&n>=12&&n<=26){const n={};for(let e=0;e<t.plots.length;++e){const r=t.plots[e],s=i.plots[e];n[r.id]=s.id}const r=Object.keys(e.styles);for(let t=0;t<r.length;++t){const i=r[t],s=e.styles[i];delete e.styles[i];const o=n[i];e.styles[o]=s}const s=Object.keys(e.plots);for(let t=0;t<s.length;++t){const i=s[t],r=e.plots[i].id;e.plots[i].id=n[r]}}return e}updateStudyInputsIfNeeded(e,t,i){if(!(i.isTVScript||!!i.pine)&&t!==i.version){const n=i&&i.defaults.inputs
;e.inputs=this.updateStudyInputs(i.id,t,i.version,e.inputs,n)}}updateStudyInputs(e,t,i,n,r){let s=(0,g.clone)(n);if(e in this._migrations){const n=u.Version.parse(t);let r;if("last"===i){const t=this.lastVersionOfStudy(e);r=u.Version.parse(t)}else r=u.Version.parse(i);s=this._migrations[e].updateInputs(n,r,s)}if(null==r)return s;for(const e in r)e in s||(s[e]=r[e]);for(const i in s)if(!(i in r)){const n=s[i];v.logWarn(`Extra input detected, studyId='${e}', versionFrom='${t}', inputId='${i}', inputValue='${n}', removing it and continue...`),delete s[i]}return s}lastVersionOfStudy(e){return(0,r.ensureDefined)(this._studiesMetainfo.find((t=>t.id===e))).version}updateMetaInfo(e){if(!e)return e;(0,r.assert)(e instanceof s.StudyMetaInfo),(0,r.assert)(!e.isTVScript,"This method should update only built-in java indicators metaInfo. For Pine indicators use updateMetaInfoAsync");const t=this._studiesMetainfo.find((t=>e.id===t.id));return t?new s.StudyMetaInfo(t.state()):null}static patchPointsBasedStudyState(e){return this._fixInputsMaxValue(e.state,e.metaInfo),"LineToolRegressionTrend"===e.type&&(e=function(e){const t={palettes:{},inputs:[{defval:2,id:"upper diviation",max:500,min:-500,name:p.t(null,void 0,i(591900)),type:"integer"},{defval:-2,id:"lower diviation",max:500,min:-500,name:p.t(null,void 0,i(831736)),type:"integer"},{defval:!0,id:"use upper diviation",name:p.t(null,void 0,i(784451)),type:"bool"},{defval:!0,id:"use lower diviation",name:p.t(null,void 0,i(449299)),type:"bool"},{defval:0,id:"first bar time",max:253370764800,min:0,name:p.t(null,void 0,i(780509)),type:"time"},{defval:0,id:"last bar time",max:253370764800,min:0,name:p.t(null,void 0,i(59933)),type:"time"},{defval:"close",id:"source",name:p.t(null,void 0,i(997751)),options:["open","high","low","close","hl2","hlc3","ohlc4"],type:"text"}],plots:[],graphics:{},defaults:{inputs:{"first bar time":0,"last bar time":0,"lower diviation":-2,source:"close","upper diviation":2,"use lower diviation":!0,"use upper diviation":!0}},_metainfoVersion:6,description:"Regression Trend",id:"RegressionTrend@tv-basicstudies",is_price_study:!0,shortDescription:"Reg Trend",shortId:"RegressionTrend",version:"2",fullId:"RegressionTrend@tv-basicstudies-2",name:"RegressionTrend@tv-basicstudies"};return e.metaInfo||(e.metaInfo=t),e}(e)),e}static patchStudyData(e,t,i,n){if(!(0,y.isProd)())return{data:t,nsData:i,indexes:n??void 0};const r=(0,g.clone)(t),o=(0,g.clone)(i),a=(0,g.clone)(n);"VbPVisible@tv-volumebyprice"===e.id&&e.version&&+e.version<=4&&this._patchOldVolumeProfiles(0,r?.graphics),"VbPSessions@tv-volumebyprice"===e.id&&e.version&&+e.version<=4&&this._patchOldVolumeProfiles(0,r?.graphics);const l=s.StudyMetaInfo.versionOf(e);if(r&&e.isTVScript&&e.TVScriptSourceCode&&l>=12&&l<=26){const e=r.columns,t=[];r.columns=t;for(let i=0;i<e.length;++i){const e="plot_"+i;t.push(e)}}return{data:r,nsData:o,indexes:a??void 0}}static patchPointsBasedStudyData(e,t){if(!(0,y.isProd)())return t;if(!e||!t)return t;const i=(0,g.clone)(t)
;return"VbPFixed@tv-volumebyprice"===e.id&&e.version&&+e.version<=4&&this._patchOldVolumeProfiles(0,i),i}static patchPropsStateAndMetaInfo(e,t,i){let r=t.state();"Script$BOOKER"!==t.productId||r.alerts||delete e.alerts,this._fixInputsOrder(e,r),this._fixInputsMaxValue(e,r);const o=this.splitInputs(e.inputs);e.inputs=o.obj;const a=s.StudyMetaInfo.versionOf(t);a<42&&r.isChildStudy&&(e.isChildStudy=r.isChildStudy);if(t.isTVScript&&t.version<60&&("Script$TV_EARNINGS@tv-scripting"!==t.id&&"Script$TV_DIVIDENDS@tv-scripting"!==t.id&&"Script$TV_SPLITS@tv-scripting"!==t.id||delete r.TVScriptSourceCode),"Volume"!==t.id&&"Volume@tv-basicstudies"!==t.id||0!==t.inputs.length||(r.inputs=[{id:"length",type:"integer",defval:20,min:1,max:1e3}],r.plots.push({id:"vol_ma",type:"line"})),"Volume@tv-basicstudies"===t.id&&t.version&&t.version<=46&&void 0===e.styles.vol.transparency&&(e.styles.vol.transparency=e.transparency||87),"PivotPointsStandard@tv-basicstudies"===t.id&&(0===r.inputs.length?(e.inputs={kind:"Traditional",showHistoricalPivots:!0},r.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]):1===r.inputs.length&&(e.inputs={kind:"Traditional"},r.inputs=[{defval:"Traditional",id:"kind",type:"text",options:["Traditional","Fibonacci","Woodie","Classic","DeMark","Camarilla"]},{id:"showHistoricalPivots",type:"bool",defval:!0}]),void 0===e._hardCodedDefaultsVersion)){e._hardCodedDefaultsVersion=1;const t=e.color;delete e.color,e.levelsStyle={colors:{P:t,"S1/R1":t,"S2/R2":t,"S3/R3":t,"S4/R4":t,"S5/R5":t}}}"CMF"===t.shortId&&2===r.inputs.length&&(e.inputs={length:e.inputs["length fast"]},r.inputs=r.inputs.splice(0,1),r.inputs[0].id="length"),r.defaults&&void 0===r.defaults.precision&&a<46&&(-1!==["Volume@tv-basicstudies","VbPVisible@tv-volumebyprice","VbPSessions@tv-volumebyprice"].indexOf(t.id)?r.defaults.precision=0:r.defaults.precision=4);let l=t.id;if(t.version<60){const e=["TV_DIVIDENDS","TV_SPLITS","TV_EARNINGS"],i=6;for(let n=0;n<e.length;n++)t.id.startsWith("Script$"+e[n]+"@tv-scripting")&&(r.fullId="ESD"+r.fullId.substring(i),r.id="ESD"+r.id.substring(i),r.name&&(r.name="ESD"+r.name.substring(i)),r.shortId="ESD"+r.shortId.substring(i),r.productId="ESD"+r.productId.substring(i),l="ESD"+t.id.substring(i))}const u={"ESD$TV_EARNINGS@tv-scripting":{fullId:"Earnings@tv-basicstudies-129!",id:"Earnings@tv-basicstudies",name:"Earnings@tv-basicstudies",shortId:"Earnings",productId:"tv-basicstudies"},"ESD$TV_SPLITS@tv-scripting":{fullId:"Splits@tv-basicstudies-129!",id:"Splits@tv-basicstudies",name:"Splits@tv-basicstudies",shortId:"Splits",productId:"tv-basicstudies"},"ESD$TV_DIVIDENDS@tv-scripting":{fullId:"Dividends@tv-basicstudies-129!",id:"Dividends@tv-basicstudies",name:"Dividends@tv-basicstudies",shortId:"Dividends",productId:"tv-basicstudies"}};if(l in u&&Object.assign(r,u[l]),a<43){const i={"StrategyScript$STD;Consecutive%1Ups/Downs%1Strategy":{pineId:"STD;Consecutive%1Ups%1Downs%1Strategy",
className:"StrategyScript"},Script$EDGR_NET_INCOME_FROM_CONTINUING_OPERATIONS_APPLICABLE_TO_COMMON_V2:{pineId:"Script$EDGR_NET_INCOME_FROM_CONTINUING_OPS_APPLICABLE_TO_COMMON_V2",className:"Script"}};if(t.shortId in i){const s=i[t.shortId].className+"$"+i[t.shortId].pineId,o={scriptIdPart:i[t.shortId].pineId,fullId:r.fullId.replace(r.shortId,s),id:r.id.replace(r.shortId,s),name:r.name?.replace(r.shortId,s),shortId:s};(0,n.default)(r,o),(0,n.default)(e,o)}const s=(0,f.extractPineId)(t.fullId),o=s&&s.match(/^(USER)(_\d+)(;)(.*)$/);if(o){const t=o[0],i=o[1]+o[3]+o[2]+o[4],s={scriptIdPart:i,fullId:r.fullId.replace(t,i),id:r.id.replace(t,i),name:r.name?.replace(t,i),shortId:r.shortId.replace(t,i)};(0,n.default)(r,s),(0,n.default)(e,s)}}if("MA"===t.id){const t={id:"MAExp",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgExp",type:"line"}],palettes:{}},i={id:"MASimple",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgSimple",type:"line"}],palettes:{}},n={id:"MAVolumeWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgVolumeWeighted",type:"line"}],palettes:{}},s={id:"MAWeighted",properties:[{id:"is_price_study",type:"bool",value:"true"}],inputs:[{id:"length",type:"integer",defval:20,min:1,max:500},{id:"source",type:"text",defval:"close",options:["open","high","low","close"]}],plots:[{id:"MovAvgWeighted",type:"line"}],palettes:{}};switch(e.inputs.type){case"exp":r=t;break;case"simple":r=i;break;case"weighted":r=s;break;case"volume weighted":r=n}e.styles[r.plots[0].id]=e.styles.MovAvg,delete e.styles.MovAvg,delete e.inputs.type}return i.oldShowStudyLastValueProperty&&(e.oldShowLastValue=e.showLastValue),delete e.showLastValue,delete e.showStudyArguments,(0,d.migrateMetaInfoAndPropState)(r,e),{propsState:e,metaInfo:r}}static splitInputs(e){const t={},i={};for(const[n,r]of Object.entries(e))(0,g.isNumber)(parseInt(n,10))?t[n]=r:i[n]=r;return{arr:t,obj:i}}static verifyInputsMaxValue(e){if(e.inputs)for(const t of e.inputs)"integer"===t.type&&t.max&&t.max>S&&v.logWarn("Bad integer input max value in metaInfo id="+e.id+" title="+e.description)}static mergeInputsObjPart(e,t){const i=this.splitInputs(t);(0,n.default)(e,i.obj)}static _fixInputsOrder(e,t){const i=this._getOrderedInputIds(t),r=this.splitInputs(e.inputs),s=r.arr,o=r.obj,a=(0,n.default)({},o);for(let e=0;e<i.length;++e){const t=i[e],n=this._findInputKeyById(s,t);null!==n&&(a[e]=s[n])}e.inputs=a}static _fixInputsMaxValue(e,t){if((0,g.isAbsent)(t))return;const i=S;if(t.inputs)for(const e of t.inputs)"integer"===e.type&&e.max&&e.max>i&&(e.max=i);if(!e||!e.inputs)return
;const r=this.splitInputs(e.inputs),s=r.arr;for(const[,e]of Object.entries(s))"integer"===e.type&&e.max&&e.max>i&&(e.max=i);e.inputs=(0,n.default)(r.obj,r.arr)}static _findInputKeyById(e,t){let i=null;for(const n in e)if((0,g.isNumber)(parseInt(n,10))&&e[n].id===t){i=n;break}return i}static _getOrderedInputIds(e){const t=[];for(const i of e.inputs)t.push(i.id);return t}static _patchOldVolumeProfiles(e,t){if(!t?.hhists)return;const i=t.hhists[e].data,n=[];for(const[,e]of Object.entries(i))n.push(e);t.hhists[0].data=n}}},322825:(e,t,i)=>{"use strict";i.d(t,{addUserScriptOnLayout:()=>l,isCountedUserScript:()=>c,removeUserScriptFromLayout:()=>u,userScriptVersionsCount:()=>a,userScriptsOnLayout:()=>d});var n=i(971417),r=i(566238),s=i(306060);const o=new r.WatchedObject([]);function a(e){return new Set(o.value().filter((t=>t.id===e)).map((e=>e.version))).size}function l(e,t){o.setValue([...o.value(),{id:e,version:t}])}function u(e,t){const i=o.value().findIndex((i=>i.id===e&&i.version===t));-1!==i&&o.value().splice(i,1),o.setValue(o.value(),!0)}function d(){return o.readonly()}function c(e){return!!e.pine&&s.Version.parse(e.pine.version).major()>=1&&(0,n.isCustomPineId)(e.scriptIdPart)}},625611:(e,t,i)=>{"use strict";i.d(t,{StudyMetaInfoBase:()=>_,replayStrategyStudyId:()=>S});var n=i(283873),r=i(154834),s=i(650151),o=i(748947),a=i(218049),l=i(124829),u=i(211183),d=i(633339),c=i(187700);const p=new Set(["CorrelationCoefficient@tv-basicstudies","Correlation - Log@tv-basicstudies-1"]),h=new Set([]),f=new Set(["line","shapes","chars","arrows","alertcondition"]),y=new Map([["AnchoredVWAP@tv-basicstudies","linetoolanchoredvwap"],["RegressionTrend@tv-basicstudies","linetoolregressiontrend"],["VbPAnchored@tv-basicstudies","linetoolanchoredvp"]]),g=/^([^\$]+)\$\d+$/,v=["bool","color","time","text_area"],S="ReplayStrategy@tv-scripting";class _{constructor(e,t=!1){(0,l.merge)(this,{palettes:{},inputs:[],plots:[],graphics:{},defaults:{}}),(0,l.merge)(this,e);const i=e.fullId||e.id;(0,l.merge)(this,_.parseIdString(i)),this._updateInputDisplayDefaults(),this.useVersionFromMetaInfo=t}state(){const e={};for(const[t,i]of Object.entries(this))"useVersionFromMetaInfo"!==t&&this.hasOwnProperty(t)&&(e[t]=(0,r.default)(i),"id"===t&&(e[t]+="-"+this.version));return e}createDefaults(){if(this.defaults){const e=(0,l.clone)(this.defaults);e.precision="default";const t=_.getStudyPropertyRootName(this);(0,u.createDefaults)(t,e)}}removeDefaults(){(0,u.removeDefaults)(_.getStudyPropertyRootName(this))}isPlotForceOverlay(e){const t=this.styles?.[e],i=this.plots.find((t=>t.id===e));return!!t?.forceOverlay||i&&(0,o.isOhlcPlot)(i)&&this.ohlcPlots?.[i.target]?.forceOverlay||!!this.ohlcPlots?.[e]?.forceOverlay}hasForceOverlayPlots(){return this.plots.some((e=>this.isPlotForceOverlay(e.id)))||Object.values(this.ohlcPlots??{}).some((e=>!!e?.forceOverlay))}static getSourceIdsByInputs(e,t){if(!Array.isArray(e)||!t)return[];const i=[];for(const r of e)if(_.isSourceInput(r)&&(0,n.default)(t[r.id])){const e=t[r.id];e.includes("$")&&i.push(e.split("$")[0])}return i
}static isSourceInput(e){return Boolean(e.id&&(("source"===e.id||"src"===e.id)&&("text"===e.type||"source"===e.type)||"source"===e.type))}static getSourceInputIds(e){const t=[];for(const i of e.inputs)_.isSourceInput(i)&&t.push(i.id);return t}static setChildStudyMetaInfoPropertiesSourceId(e,t,i){for(const n of e.inputs){if(!_.isSourceInput(n))continue;const e=i.childs().inputs&&i.childs().inputs.childs()[n.id];if(e){const i=e.value(),n=g.exec(i);if(2===n?.length){if("{pid}"===n[1]){const n=i.replace(/^[^\$]+/,t);e.setValue(n)}}}}}static patchSoSInputs(e,t){const i=e=>{const i=g.exec(e);if(2===i?.length){const n=i[1],r=`${(0,s.ensureNotNull)(t(n))}`;return e.replace(/^[^\$]+/,r)}return e};for(const t in e)if(/in_[\d+]/.test(t)||"source"===t){const r=e[t];(0,n.default)(r)?e[t]=i(r):(0,a.isExtendedInput)(r)&&(0,a.isExtendedInputSource)(r)&&(r.v=i(r.v))}}static canBeChild(e){if((0,n.default)(e))return!0;if(!e)return!1;if(e.extra&&!_.isAllowedSourceInputsCount(e.extra.sourceInputsCount)||!0===e.canNotBeChild||!1===e.canBeChild||p.has(e.id))return!1;let t=0;for(const i of e.inputs)_.isSourceInput(i)&&(t+=1);return _.isAllowedSourceInputsCount(t)}static isAllowedSourceInputsCount(e){return e>0||1===e}static canHaveChildren(e){if(e){if(e.isTVScriptStrategy||e.TVScriptSourceCode&&(0,c.isStrategy)(e.TVScriptSourceCode))return!1;if(e.id&&!h.has(e.id)&&Array.isArray(e.plots))for(const t of e.plots)if(f.has(t.type))return!0}return!1}static getChildSourceInputTitles(e,t,i){const n={};if(t.plots&&t.plots.length&&e.options&&e.options.length)for(const r of e.options){const e=r?+r.split("$")[1]:NaN,s=isFinite(e)&&t.plots[e];s&&f.has(s.type)&&(n[r]=t.styles&&t.styles[s.id]&&t.styles[s.id]?.title||s.id,i&&(n[r]=i+":"+n[r]))}return n}static canPlotBeSourceOfChildStudy(e){return f.has(e)}static getStudyPropertyRootName(e){const t=y.get(e.id);if(void 0!==t)return t;let i="study_"+e.id;return e.pine&&e.pine.version&&(i+="_"+e.pine.version.replace(".","_")),i}static getStudyPropertyRootNameById(e){const t=y.get(e);return void 0!==t?t:"study_"+e}static isScriptStrategy(e){if(e.extra&&e.extra.kind)return"strategy"===e.extra.kind;if(!0===e.isTVScriptStrategy)return!0;const t=e.TVScriptSourceCode||e.scriptSource;return!!t&&(0,c.isStrategy)(t)}static isReplayStrategy(e){return e.id===S}static parseIdString(e){return(0,d.parseIdString)(e)}_updateInputDisplayDefaults(){this.inputs.filter((e=>void 0===e.display)).forEach((e=>{v.includes(e.type)?e.display=a.InputDisplayFlags.None:e.display=a.InputDisplayFlags.All}))}}},187700:(e,t,i)=>{var n;e=i.nmd(e),"undefined"!=typeof window&&(n=window.TVScript=window.TVScript||{}),(n=n||{}).Access={},n.Access.ACCESS_OPEN_NO_AUTH="open_no_auth",n.Access.ACCESS_CLOSED_NO_AUTH="closed_no_auth",n.Access.ACCESS_CLOSED_NEEDS_AUTH="closed_needs_auth",n.Access.MAP_ID_TO_NAME={1:n.Access.ACCESS_OPEN_NO_AUTH,2:n.Access.ACCESS_CLOSED_NO_AUTH,3:n.Access.ACCESS_CLOSED_NEEDS_AUTH},n.Access.MAP_NAME_TO_ID={},Object.keys(n.Access.MAP_ID_TO_NAME).forEach((function(e){n.Access.MAP_NAME_TO_ID[n.Access.MAP_ID_TO_NAME[e]]=e})),
n.PinePrefix={},n.PinePrefix.USER="USER;",n.PinePrefix.PUB="PUB;",n.PinePrefix.STD="STD;",n.PinePrefix.TV="TV_",n.PinePrefix.EDGR="EDGR_",n.PineType={},n.PineType.UserSaved="PineType_UserSaved",n.PineType.UserPublished="PineType_UserPublished",n.PineType.BuiltIn="PineType_BuiltIn",n.PineType.Addon="PineType_Addon",n.Type=n.Type||function(){},n.Type.VOID="void",n.Type.INTEGER="integer",n.Type.FLOAT="float",n.Type.STRING="string",n.Type.BOOL="bool",n.Type.COLOR="color",n.Type.SERIES="series",n.Type.PLOT="plot",n.Type.HLINE="hline",n.Type.BARCOLOR="barcolor",n.Type.BGCOLOR="bgcolor",n.Type.PLOTSHAPES="plotshape",n.Type.PLOTCHARS="plotchar",n.Type.PLOTARROWS="plotarrow",n.Type.NA="na",n.Type.ARRAY="array",n.TranslatorDefaultVersion=1,n.TranslatorReferenceVersioningIntroduced=4,n.TranslatorLastVersion=6,n.pineType=function(e){return e.startsWith(n.PinePrefix.USER)?n.PineType.UserSaved:e.startsWith(n.PinePrefix.PUB)?n.PineType.UserPublished:e.startsWith(n.PinePrefix.STD)||e.startsWith(n.PinePrefix.TV)||e.startsWith(n.PinePrefix.EDGR)?n.PineType.BuiltIn:n.PineType.Addon},n.patchILTemplate=function(e,t,i){var r=i||{};return n._patchTemplate(/<(in_\d+)>/g,e,t,r)},n.decorateQuotes=function(e){if(!e)return e;var t=/([^\\']+?)(')[^']*?/g,i="$1\\$2",n=e;return"'"==n.charAt(0)&&"'"==n.charAt(n.length-1)?"'"+(n=n.substr(1,n.length-2)).replace(t,i)+"'":n.replace(t,i)},n.patchInputs=function(e,t){var i={};for(var n in e)if(e.hasOwnProperty(n)){var r,s=e[n];r=s.isFake?{v:t[s.id],f:!0,t:s.type}:t[s.id],i[s.id]=r}return i},n._patchTemplate=function(e,t,i,r){var s=r||{};return t.replace(e,(function(e,t){for(var r=(t in s?s[t]:i.defaults.inputs[t]),o=0;o<i.inputs.length;++o)if(i.inputs[o].id===t)if("bool"===i.inputs[o].type)r=r?"1.0":"0.0";else if(["text","symbol","resolution","session"].indexOf(i.inputs[o].type)>=0)r="'"+n.decorateQuotes(r)+"'";else if("source"===i.inputs[o].type){var a=r.split("$");a[0]="'"+a[0]+"'",r="source("+a.join(",")+")"}return r}))},n.isStrategy=function(e){return/^\s*strategy\s*\(/m.test(e)};var r=/^\s*\/\/\s*?@version\s*?=\s*?(\S*?)\s*?$/gm,s=/^[0-9]+$/;n.extractVersion=function(e){r.lastIndex=0;var t=r.exec(e);if(null===t)return 1;var i=t[1],o=s.test(i)?Number(i):NaN;return isNaN(o)?1:Math.max(n.TranslatorDefaultVersion,Math.min(o,n.TranslatorLastVersion))},n.canUpgradeVersion=function(e){return e>=3&&e<n.TranslatorLastVersion},n.canDowngradeVersion=function(e){return e>=4&&e<=n.TranslatorLastVersion},e&&e.exports&&(e.exports=n)},120984:(e,t,i)=>{"use strict";i.d(t,{AsyncResourceWrapper:()=>n});class n{constructor(e,t){this._destroyed=!1,this._callbacks=[],this._resource={pendingResource:e},e.then((e=>{if(this._destroyed)this._destroyFn?.(e);else{for(const t of this._callbacks)t(e);this._resource.resource=e}})).finally((()=>{this._callbacks=[]}))}destroy(){this._resource.resource&&this._destroyFn?.(this._resource.resource),this._resource={pendingResource:Promise.reject("Resource is destroyed").catch((()=>{}))},this._callbacks=[],this._destroyed=!0}callFunction(e){
this._destroyed||(this._resource.resource?e(this._resource.resource):this._callbacks.push(e))}get(){return this._destroyed||!this._resource.resource?null:this._resource.resource}promise(){return this._resource.pendingResource}}}}]);